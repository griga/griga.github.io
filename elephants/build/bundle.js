"use strict";window.onload=function(){new M22Games.Game};var __extends=this&&this.__extends||function(t,s){function e(){this.constructor=t}for(var i in s)s.hasOwnProperty(i)&&(t[i]=s[i]);t.prototype=null===s?Object.create(s):(e.prototype=s.prototype,new e)},M22Games;!function(t){var s=function(s){function e(e,i,a,n,h,o){void 0===n&&(n=1),void 0===h&&(h=10),void 0===o&&(o=0),s.call(this,e),this.game=e,this.top=i,this.color=a,this.direction=n,this.count=h,this.angle=o;for(var r=0;h>r;r++){var l=new t.Elephant(this.game,0,0,a,n);this.add(l)}}return __extends(e,s),e.prototype.launch=function(){var s=this.getFirstDead();null!==s&&void 0!==s&&(s.revive(),s.checkWorldBounds=!0,s.outOfBoundsKill=!1,s.reset(this.direction>0?-1*t.Elephant.WIDTH+96:this.game.width+t.Elephant.WIDTH-96,this.top-t.Elephant.HEIGHT),s.animations.play("walk"))},e}(Phaser.Group);t.Elephants=s}(M22Games||(M22Games={}));var M22Games;!function(t){var s=function(t){function s(e,i,a,n){void 0===a&&(a=1),void 0===n&&(n=0),t.call(this,e,i,"black",a,s.MAX),this.game=e,this.top=i,this.direction=a,this.angle=n,this.lastLaunchAt=this.game.time.now-s.LAUNCH_DELAY}return __extends(s,t),s.prototype.launch=function(){this.game.time.now-this.lastLaunchAt<s.LAUNCH_DELAY||(this.lastLaunchAt=this.game.time.now,this.countLiving()!=s.MAX&&t.prototype.launch.call(this))},s.MAX=12,s.LAUNCH_DELAY=1e4,s}(t.Elephants);t.Blacks=s}(M22Games||(M22Games={}));var M22Games;!function(t){var s=function(t){function s(s,e,i,a,n){void 0===n&&(n=1),t.call(this,s,e,i,"elephant-"+a),this.direction=n,this.anchor.set(.5,0),this.animations.add("walk",[0,1,2,3,5,6,7],4,!0),this.scale.x=n,s.physics.enable(this,Phaser.Physics.ARCADE),s.add.existing(this),this.kill()}return __extends(s,t),s.prototype.update=function(){this.body.velocity.x=24*this.scale.x;var t=1==this.direction?this.x>this.game.width+s.WIDTH:this.x<-1*s.WIDTH;t&&this.kill()},s.HEIGHT=144,s.WIDTH=216,s}(Phaser.Sprite);t.Elephant=s}(M22Games||(M22Games={}));var M22Games;!function(t){var s=function(s){function e(){s.apply(this,arguments)}return __extends(e,s),e.prototype.create=function(){this.game.add.tileSprite(0,0,800,600,"bg"),this.whites=new t.Whites(this.game,600),this.blacks=new t.Blacks(this.game,300,-1)},e.prototype.update=function(){this.whites.launch(),this.blacks.launch()},e.prototype.render=function(){this.whites.forEach(function(t){},this)},e}(Phaser.State);t.Scene=s}(M22Games||(M22Games={}));var M22Games;!function(t){var s=function(t){function s(e,i,a,n){void 0===a&&(a=1),void 0===n&&(n=0),t.call(this,e,i,"white",a,s.MAX),this.game=e,this.top=i,this.direction=a,this.angle=n,this.lastLaunchAt=this.game.time.now-s.LAUNCH_DELAY}return __extends(s,t),s.prototype.launch=function(){this.game.time.now-this.lastLaunchAt<s.LAUNCH_DELAY||(this.lastLaunchAt=this.game.time.now,this.countLiving()!=s.MAX&&t.prototype.launch.call(this))},s.MAX=12,s.LAUNCH_DELAY=1e4,s}(t.Elephants);t.Whites=s}(M22Games||(M22Games={}));var M22Games;!function(t){var s=function(t){function s(){t.apply(this,arguments)}return __extends(s,t),s.prototype.preload=function(){this.load.image("loader","assets/graphics/loading-bar.png")},s.prototype.create=function(){this.input.maxPointers=1,this.stage.disableVisibilityChange=!0,this.game.device.desktop?(this.scale.pageAlignHorizontally=!0,this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL):(this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.scale.minWidth=480,this.scale.minHeight=260,this.scale.maxWidth=1024,this.scale.maxHeight=768,this.scale.forceLandscape=!0,this.scale.pageAlignHorizontally=!0,this.scale.refresh()),this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.state.start("Preloader",!0,!1)},s}(Phaser.State);t.Boot=s}(M22Games||(M22Games={}));var M22Games;!function(t){t.Config={DEBUG:!0}}(M22Games||(M22Games={}));var M22Games;!function(t){var s=function(s){function e(){s.call(this,{width:800,height:600,parent:"game-canvas",renderer:Phaser.AUTO,state:null}),this.state.add("Boot",t.Boot,!1),this.state.add("Preloader",t.Preloader,!1),this.state.add("Scene",t.Scene,!1),this.state.start("Boot")}return __extends(e,s),e}(Phaser.Game);t.Game=s}(M22Games||(M22Games={}));var M22Games;!function(t){var s=function(t){function s(){t.apply(this,arguments)}return __extends(s,t),s.prototype.create=function(){this.game.stage.backgroundColor="#003212",this.start=this.game.add.button(this.game.width/2-54,this.game.height/2-24,"button",this.startGame),this.start.onInputDown.add(this.pressButton,this),this.start.onInputUp.add(this.unPressButton,this)},s.prototype.pressButton=function(){this.start.y+=2},s.prototype.unPressButton=function(){this.start.y-=2},s.prototype.startGame=function(){this.game.state.start("Level1",!0,!1)},s}(Phaser.State);t.MainMenu=s}(M22Games||(M22Games={}));var M22Games;!function(t){var s=function(t){function s(){t.apply(this,arguments)}return __extends(s,t),s.prototype.preload=function(){this.preloadBar=this.add.sprite(200,250,"loader"),this.load.setPreloadSprite(this.preloadBar),this.load.spritesheet("elephant-white","assets/graphics/elephant-transparent.png",216,144),this.load.spritesheet("elephant-black","assets/graphics/elephant-transparent-invert.png",216,144),this.load.image("bg","assets/graphics/bg.png"),this.load.image("bg1","assets/graphics/bg2.png")},s.prototype.create=function(){var t=this.add.tween(this.preloadBar).to({alpha:0},100,Phaser.Easing.Linear.None,!0);t.onComplete.add(this.startMainMenu,this)},s.prototype.startMainMenu=function(){this.game.state.start("Scene",!0,!1)},s}(Phaser.State);t.Preloader=s}(M22Games||(M22Games={}));var M22Games;!function(t){var s=function(s){function e(i,a){s.call(this,i),this.aim=a,this.lastEnemySpawn=0;for(var n=0;n<e.MAX_COUNT;n++){var h=new t.Enemy(i,a);this.add(h)}}return __extends(e,s),e.prototype.spawn=function(){if(!(this.game.time.now-this.lastEnemySpawn<e.SPAWN_DELAY)&&(this.lastEnemySpawn=this.game.time.now,this.countLiving()!=e.MAX_COUNT)){var t=this.getFirstDead();if(null!==t&&void 0!==t){t.revive(),t.checkWorldBounds=!0,t.outOfBoundsKill=!0,t.reset(this.game.world.randomX,0);var s=2*Math.random()+.5;t.scale={x:s,y:s}}}},e.MAX_COUNT=20,e.SPAWN_DELAY=1e3,e}(Phaser.Group);t.Enemies=s}(M22Games||(M22Games={}));var M22Games;!function(t){var s=function(t){function s(s,e){t.call(this,s,0,0,"enemy"+s.rnd.integerInRange(1,3)),this.aim=e,this.speed=this.game.rnd.integerInRange(100,200),this.anchor.setTo(.5,.5),s.physics.enable(this,Phaser.Physics.ARCADE),s.add.existing(this),this.kill()}return __extends(s,t),s.prototype.update=function(){var t=Phaser.Math.angleBetween(this.x,this.y,this.aim.x,Math.abs(this.aim.y-this.y)<30?this.game.height:this.aim.y);if(this.rotation!==t){var s=t-this.rotation;s>Math.PI&&(s-=2*Math.PI),s<-Math.PI&&(s+=2*Math.PI),s>0?this.angle+=1:this.angle-=1,Math.abs(s)<Phaser.Math.degToRad(1)&&(this.rotation=t)}this.body.velocity.x=Math.cos(this.rotation)*this.speed,this.body.velocity.y=Math.sin(this.rotation)*this.speed},s}(Phaser.Sprite);t.Enemy=s}(M22Games||(M22Games={}));var M22Games;!function(t){var s=function(t){function s(s){t.call(this,s),this.createMultiple(30,"kaboom"),this.explosionSound=this.game.add.audio("explosion"),this.forEach(function(t){t.anchor.set(.5,.5),t.animations.add("kaboom")},this)}return __extends(s,t),s.prototype.boom=function(t,s){var e=this.getFirstDead();e.reset(t,s),e.play("kaboom",30,!1,!0),this.explosionSound.play()},s}(Phaser.Group);t.Explosions=s}(M22Games||(M22Games={}));var M22Games;!function(t){var s=function(t){function s(e,i){t.call(this,e),this.game=e,this.owner=i,this.shotSound=this.game.add.audio("blaster");for(var a=0;a<s.NUMBER_OF_BULLETS;a++){var n=this.game.add.sprite(0,0,"bullet1");this.add(n),n.anchor.setTo(.5,.5),e.physics.enable(n,Phaser.Physics.ARCADE),e.add.existing(this),n.kill()}}return __extends(s,t),s.prototype.shoot=function(){if(void 0===this.lastBulletShotAt&&(this.lastBulletShotAt=0),!(this.game.time.now-this.lastBulletShotAt<s.SHOT_DELAY)){this.lastBulletShotAt=this.game.time.now;var t=this.getFirstDead();null!==t&&void 0!==t&&(t.revive(),t.checkWorldBounds=!0,t.outOfBoundsKill=!0,t.reset(this.owner.x,this.owner.y),t.rotation=this.owner.rotation,t.body.velocity.x=Math.sin(t.rotation)*s.BULLET_SPEED,t.body.velocity.y=-1*Math.cos(t.rotation)*s.BULLET_SPEED,this.shotSound.play())}},s.SHOT_DELAY=100,s.BULLET_SPEED=500,s.NUMBER_OF_BULLETS=20,s}(Phaser.Group);t.Gun=s}(M22Games||(M22Games={}));var M22Games;!function(t){var s=function(s){function e(){s.apply(this,arguments)}return __extends(e,s),e.prototype.create=function(){this.sky=new t.Sky(this.game),this.player=new t.Player(this.game),this.enemies=new t.Enemies(this.game,this.player),this.explosions=new t.Explosions(this.game),this.status=new t.Status(this.game,this.player)},e.prototype.restart=function(){var t=this;this.enemies.forEach(function(s){setTimeout(function(){s.kill(),t.explosions.boom(s.x,s.y)},t.game.rnd.integerInRange(100,300))},this,!0),setTimeout(function(){t.player.revive(1),t.status.reset()},350)},e.prototype.update=function(){this.enemies.spawn(),this.game.physics.arcade.overlap(this.player.gun,this.enemies,this.collisionHandler,null,this),this.game.physics.arcade.overlap(this.enemies,this.player,this.enemyHitsPlayer,null,this),this.status.update()},e.prototype.collisionHandler=function(t,s){this.status.score+=Math.floor(1e3*s.scale.x),t.kill(),s.kill(),this.explosions.boom(s.x,s.y)},e.prototype.enemyHitsPlayer=function(t,s){t.enemyHit(s),this.explosions.boom(s.x,s.y),t.health<0&&(this.explosions.boom(t.x,t.y),t.kill(),this.gameOver())},e.prototype.gameOver=function(){this.status.gameOver();var t=this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);t.onDown.addOnce(this.restart,this)},e.prototype.render=function(){t.Config.DEBUG},e}(Phaser.State);t.Level1=s}(M22Games||(M22Games={}));var M22Games;!function(t){var s=function(s){function e(e){var i=e.width/2-20,a=e.height-75;s.call(this,e,i,a,"ship"),e.add.existing(this),e.physics.enable(this,Phaser.Physics.ARCADE),this.anchor.set(.5,.5),this.speed=150,this.angle=0,this.gun=new t.Gun(e,this),this.cursors=e.input.keyboard.createCursorKeys()}return __extends(e,s),e.prototype.enemyHit=function(t){this.health=this.health-10*t.scale.x/100,t.kill()},e.prototype.getHealthText=function(){return"Health: "+Math.floor(1e3*this.health)/10+"%"},e.prototype.update=function(){this.alive&&(this.body.velocity.x=0,this.body.velocity.y=0,this.cursors.left.isDown?(this.body.velocity.x=-1*this.speed,this.angle>=-23&&(this.angle-=.5,this.scale.x+=.005*Phaser.Math.sign(this.angle))):this.cursors.right.isDown?(this.body.velocity.x=this.speed,this.angle<=23&&(this.angle+=.5,this.scale.x-=.005*Phaser.Math.sign(this.angle))):(0!=this.angle&&(this.angle-=Phaser.Math.sign(this.angle)/2),1!=this.scale.x&&(this.scale.x+=.005)),this.cursors.up.isDown?this.body.velocity.y=-1*this.speed:this.cursors.down.isDown&&(this.body.velocity.y=this.speed),this.game.input.keyboard.isDown(Phaser.Keyboard.SPACEBAR)&&this.gun.shoot())},e}(Phaser.Sprite);t.Player=s}(M22Games||(M22Games={}));var M22Games;!function(t){var s=function(t){function s(s){t.call(this,s,0,0,800,600,"starfield"),s.add.existing(this)}return __extends(s,t),s.prototype.update=function(){this.game.input.keyboard.isDown(Phaser.Keyboard.LEFT)?this.tilePosition.x+=.25:this.game.input.keyboard.isDown(Phaser.Keyboard.RIGHT)&&(this.tilePosition.x-=.25),this.tilePosition.y+=2},s}(Phaser.TileSprite);t.Sky=s}(M22Games||(M22Games={}));var M22Games;!function(t){var s=function(){function t(t,s){this.game=t,this.player=s,this.score=0,this.statusHealth=this.game.add.bitmapText(8,8,"informa",this.player.getHealthText()),this.statusScore=this.game.add.bitmapText(8,40,"informa","Score: "+this.score),this.statusOver=this.game.add.bitmapText(0,220,"informa","GAME OVER",80),this.statusOver.visible=!1,this.statusOver.x=(this.game.width-this.statusOver.width)/2,this.scoreOver=this.game.add.bitmapText(0,300,"informa","Your score: "+this.score,50),this.scoreOver.visible=!1,this.pressStart=this.game.add.bitmapText(0,550,"informa","Press SPACEBAR to start again",40),this.pressStart.visible=!1,this.pressStart.x=(this.game.width-this.pressStart.width)/2}return t.prototype.reset=function(){this.score=0,this.statusOver.visible=!1,this.scoreOver.visible=!1,this.pressStart.visible=!1,this.statusScore.visible=!0,this.statusHealth.visible=!0},t.prototype.update=function(){this.statusHealth.text=this.player.getHealthText(),this.statusScore.text="Score: "+this.score},t.prototype.gameOver=function(){this.statusHealth.visible=!1,this.statusScore.visible=!1,this.statusOver.visible=!0,this.pressStart.visible=!0,this.scoreOver.text="Your score: "+this.score,this.scoreOver.x=this.game.width/2-this.scoreOver.width/2,this.scoreOver.visible=!0},t}();t.Status=s}(M22Games||(M22Games={}));